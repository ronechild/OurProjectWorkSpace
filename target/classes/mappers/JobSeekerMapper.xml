<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring5legacy.ourpro00.mapper.JobSeekerMapper">

	<!-- 구직자 본인의 구직글 목록 조회 -->
	<select id="selectJobSeekerList" resultType="com.spring5legacy.ourpro00.domain.JobSeekerVO">
		SELECT ano, atitle, acontent, awriter, aregdate, bno   
			FROM ouruser.tbl_apply
			WHERE awriter = #{awriter} 
	</select>
	
	<!-- 디테일 페이지 구직글 목록 조회 -->
	<select id="selectJobSeekerListForDetail" resultType="com.spring5legacy.ourpro00.domain.JobSeekerVO">
		SELECT ano, atitle, acontent, awriter, aregdate, bno   
			FROM ouruser.tbl_apply
			WHERE bno = #{bno} ORDER BY bno DESC
	</select>
	
	 <resultMap type="com.spring5legacy.ourpro00.domain.JobSeekerAttachFileVO" id="attachFileMap">
      <result property="Uuid" column="Uuid"/>
      <result property="FileName" column="FileName"/>
      <result property="UploadPath" column="UploadPath"/>      
      <result property="ano" column="ano"/>
   </resultMap>
   <resultMap type="com.spring5legacy.ourpro00.domain.JobSeekerVO" id="JobSeekerVOMap">
      <result property="ano" column="ano"/>
      <result property="atitle" column="atitle"/>
      <result property="acontent" column="acontent"/>
      <result property="awriter" column="awriter"/>
      <result property="aregDate" column="aregDate"/>
      <result property="bno" column="bno"/>
      <collection property="jobSeekerAttachFileList"  resultMap="attachFileMap"/>
   </resultMap>
	<!-- 특정 구직글 조회 -->
	<select id="selectJobSeeker" resultType="com.spring5legacy.ourpro00.domain.JobSeekerVO" resultMap="JobSeekerVOMap">
		SELECT ano, atitle, acontent, awriter, aregdate, bno   
			FROM ouruser.tbl_apply
			WHERE ano = #{ano} 
	</select>
	
	<!-- 구직글 총 수 -->
	<select id="selectRowTotal">
		select count(*) FROM ouruser.tbl_apply
	</select>
	
	<!-- 구직글 등록 -->
	<insert id="insertJobSeeker">
	<selectKey keyProperty="ano" order="BEFORE" resultType="Long">
			SELECT ouruser.seq_tbl_apply.nextval FROM DUAL
		</selectKey>
		INSERT INTO ouruser.tbl_apply
			VALUES (#{ano}, #{atitle}, #{acontent}, #{awriter}, default, #{bno}) 
	</insert>
	
	<!-- 특정 구직글 수정 -->
	<update id="updateJobSeeker">
		UPDATE ouruser.tbl_apply
			SET atitle = #{atitle},
  					 acontent = #{acontent}
		WHERE ano = #{ano}
	</update>
	
	
	<!-- 특정 구직글 삭제 -->
	<delete id="deleteJobSeeker">
		DELETE FROM ouruser.tbl_apply WHERE ano = #{ano} 
	</delete>
	
</mapper>